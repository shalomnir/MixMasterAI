<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>Admin Dashboard - AI Cocktail Mixer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;700&display=swap');

        body {
            font-family: 'Outfit', sans-serif;
        }

        /* Toast Animation */
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }

            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .toast-enter {
            animation: slideIn 0.3s ease-out forwards;
        }

        /* Modal Backdrop */
        .modal-backdrop {
            background-color: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(4px);
        }

        /* Autosave Spinner */
        .saving-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }
    </style>
</head>

<body class="bg-slate-950 text-slate-100 min-h-screen selection:bg-pink-500 selection:text-white">

    <!-- Sticky Header -->
    <header class="sticky top-0 z-40 bg-slate-900/80 backdrop-blur-md border-b border-slate-800 shadow-lg">
        <div class="container mx-auto px-4 h-16 flex justify-between items-center">
            <div class="flex items-center gap-3">
                <div
                    class="w-2 h-8 bg-gradient-to-b from-pink-500 to-violet-600 rounded-full shadow-[0_0_10px_rgba(236,72,153,0.5)]">
                </div>
                <div>
                    <h1
                        class="text-xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-white to-slate-400">
                        Admin Panel
                    </h1>
                </div>
            </div>

            <div class="flex items-center gap-4">
                {% if current_user.is_authenticated %}
                <div class="hidden md:block text-right">
                    <p class="text-[10px] uppercase tracking-wider text-slate-500 font-bold">Logged In As</p>
                    <p class="text-sm font-bold text-slate-200">{{ current_user.nickname }}</p>
                </div>
                {% endif %}

                <!-- Logout button removed as per persistent session logic -->
            </div>
        </div>
    </header>

    <!-- Floating Toast Container -->
    <div id="toast-container" class="fixed bottom-4 right-4 z-50 flex flex-col gap-2 pointer-events-none">
        {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
        {% for category, message in messages %}
        {% set border_color = 'border-green-500' if category == 'success' else 'border-red-500' if category == 'error'
        else 'border-blue-500' %}
        {% set bg_color = 'bg-slate-800' %}
        {% set icon = '✅' if category == 'success' else '⚠️' if category == 'error' else 'ℹ️' %}
        <div
            class="toast-enter pointer-events-auto {{ bg_color }} text-white border-l-4 {{ border_color }} shadow-2xl rounded-r-lg p-4 flex items-center gap-3 min-w-[300px] max-w-sm">
            <span class="text-lg">{{ icon }}</span>
            <p class="text-sm font-medium text-slate-200">{{ message }}</p>
            <button onclick="this.parentElement.remove()" class="ml-auto text-slate-500 hover:text-white">×</button>
        </div>
        {% endfor %}
        {% endif %}
        {% endwith %}
    </div>

    <!-- Main Content -->
    <main class="container mx-auto p-4 md:p-6 pb-20 max-w-7xl">
        {% block content %}{% endblock %}
    </main>

    <!-- Global Confirmation Modal -->
    <div id="confirm-modal" class="fixed inset-0 z-[100] hidden">
        <div class="absolute inset-0 modal-backdrop transition-opacity" onclick="closeModal()"></div>
        <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-full max-w-sm p-4">
            <div
                class="bg-slate-900 border border-slate-700 rounded-2xl shadow-2xl p-6 text-center transform transition-all scale-100">
                <div
                    class="w-16 h-16 bg-red-900/30 rounded-full flex items-center justify-center mx-auto mb-4 border border-red-500/30">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-red-500" fill="none" viewBox="0 0 24 24"
                        stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                    </svg>
                </div>
                <h3 class="text-lg font-bold text-white mb-2">Are you sure?</h3>
                <p id="modal-message" class="text-sm text-slate-400 mb-6">This action cannot be undone.</p>
                <div class="flex gap-3">
                    <button onclick="closeModal()"
                        class="flex-1 px-4 py-2 bg-slate-800 hover:bg-slate-700 text-slate-300 rounded-xl font-semibold transition border border-slate-700">
                        Cancel
                    </button>
                    <button id="modal-confirm-btn"
                        class="flex-1 px-4 py-2 bg-red-600 hover:bg-red-500 text-white rounded-xl font-semibold transition shadow-[0_0_15px_rgba(220,38,38,0.4)]">
                        Confirm
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Auto-dismiss toasts
        setTimeout(() => {
            const toasts = document.querySelectorAll('.toast-enter');
            toasts.forEach(t => {
                t.style.opacity = '0';
                t.style.transform = 'translateY(10px)';
                t.style.transition = 'all 0.5s ease';
                setTimeout(() => t.remove(), 500);
            });
        }, 4000);

        // Toast Helper
        function showToast(message, type = 'success') {
            const container = document.getElementById('toast-container');
            const toast = document.createElement('div');

            const borderClass = type === 'success' ? 'border-green-500' : 'border-red-500';
            const icon = type === 'success' ? '✅' : '⚠️';

            toast.className = `toast-enter pointer-events-auto bg-slate-800 text-white border-l-4 ${borderClass} shadow-2xl rounded-r-lg p-4 flex items-center gap-3 min-w-[300px] max-w-sm`;
            toast.innerHTML = `
                <span class="text-lg">${icon}</span>
                <p class="text-sm font-medium text-slate-200">${message}</p>
                <button onclick="this.parentElement.remove()" class="ml-auto text-slate-500 hover:text-white">×</button>
            `;

            container.appendChild(toast);

            setTimeout(() => {
                toast.style.opacity = '0';
                toast.style.transform = 'translateY(10px)';
                toast.style.transition = 'all 0.5s ease';
                setTimeout(() => toast.remove(), 500);
            }, 3000);
        }

        // Modal Logic
        let currentForm = null;

        function confirmAction(event, message) {
            event.preventDefault();
            currentForm = event.target;
            document.getElementById('modal-message').textContent = message || "This specific action cannot be undone.";
            document.getElementById('confirm-modal').classList.remove('hidden');
        }

        function closeModal() {
            document.getElementById('confirm-modal').classList.add('hidden');
            currentForm = null;
        }

        document.getElementById('modal-confirm-btn').addEventListener('click', () => {
            if (currentForm) {
                currentForm.submit();
            }
            closeModal();
        });

        // Close on Escape key
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') closeModal();
        });
    </script>
</body>

</html>