{% extends 'base.html' %}

{% block content %}
<style>
    html,
    body {
        overflow: hidden !important;
        height: 100dvh !important;
        max-height: 100dvh !important;
    }

    /* Hide header and footer on login page */
    header,
    footer {
        display: none !important;
    }

    /* Remove main padding for full-screen */
    main {
        padding: 0 !important;
        padding-bottom: 0 !important;
    }
</style>
<div class="h-[100dvh] overflow-hidden flex items-center justify-center p-4"
    style="padding-bottom: calc(1rem + env(safe-area-inset-bottom));">
    <div class="glass rounded-3xl p-10 md:p-14 max-w-lg w-full border border-white/10 shadow-2xl">
        <div class="text-center space-y-8">
            <div class="space-y-3">
                <h1
                    class="text-5xl md:text-6xl font-extrabold bg-clip-text text-transparent bg-gradient-to-r from-pink-500 to-violet-500">
                    Pour It Up.
                </h1>
                <p class="text-slate-400 text-base md:text-lg">The AI-powered cocktail experience.</p>
            </div>

            <!-- Error Message Display -->
            <div id="error-message"
                class="hidden bg-red-900/30 border border-red-500/50 text-red-300 px-4 py-3 rounded-xl text-sm"></div>

            <form id="registration-form" method="POST" action="{{ url_for('index') }}" class="space-y-5">
                <div>
                    <label for="nickname" class="block text-base text-slate-400 mb-3">Who are you?</label>
                    <input type="text" name="nickname" id="nickname" required autofocus
                        placeholder="Enter your nickname"
                        class="w-full px-5 py-4 text-lg rounded-xl bg-slate-800 border border-slate-700 text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-pink-500 focus:border-transparent transition">
                </div>
                <button type="submit" id="submit-btn"
                    class="w-full py-5 text-xl bg-gradient-to-r from-pink-600 to-violet-600 rounded-xl font-bold shadow-lg hover:scale-[1.02] transition transform active:scale-95">
                    Start Mixing
                </button>
            </form>

            <!-- Recovery Link -->
            <div class="pt-4 border-t border-slate-700">
                <p class="text-slate-500 text-sm md:text-base mb-3">Lost your session?</p>
                <a href="{{ url_for('recovery') }}"
                    class="text-pink-400 hover:text-pink-300 text-base font-semibold transition-colors">
                    â†’ Recover Account with Key
                </a>
            </div>
        </div>
    </div>
</div>

<script>
    document.getElementById('registration-form').addEventListener('submit', function (e) {
        e.preventDefault();

        const form = this;
        const submitBtn = document.getElementById('submit-btn');
        const errorDiv = document.getElementById('error-message');
        const nicknameInput = document.getElementById('nickname');

        // Disable button during submission
        submitBtn.disabled = true;
        submitBtn.textContent = 'Loading...';
        errorDiv.classList.add('hidden');

        // Send AJAX request
        fetch(form.action, {
            method: 'POST',
            headers: {
                'X-Requested-With': 'XMLHttpRequest'
            },
            body: new FormData(form)
        })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'success') {
                    // Redirect on success
                    window.location.href = data.redirect;
                } else {
                    // Show error message
                    errorDiv.textContent = data.message;
                    errorDiv.classList.remove('hidden');
                    nicknameInput.focus();
                    nicknameInput.select();

                    // Re-enable button
                    submitBtn.disabled = false;
                    submitBtn.textContent = 'Start Mixing';
                }
            })
            .catch(error => {
                // Fallback: submit form normally if AJAX fails
                form.submit();
            });
    });
</script>
{% endblock %}